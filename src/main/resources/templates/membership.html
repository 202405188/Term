<!Doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Yumin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
        
        .w-60 {   /* w-60은 부트스트랩에서 제공하는 유틸리티 클래스*/
            width: 60% !important;  /* 너비가 60%으로 클래스를 새로 정의*/
        }

        body{
            font-family:'Playfair Display', serif;
            text-align : center;
            margin : 0;
        }
        .main-header{
            background-color : #fafafa;
            padding : 20px 0;
        }
        .header-menu{
            display : flex;
            align-items : center;
            justify-content: center;
        }
        .logo{
            font-size : 28px;
            margin : 0 320px;
        }
        .logo a{
            text-decoration : none;
            color : rgb(50, 50, 50);
        }
        .header-links {
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            list-style : none;
            padding : 0;
            margin : 0;
            display : flex;
            gap : 60px;
        }
        .header-item {
            position : relative; 
        }
        .header-links a{
            text-decoration : none; 
            color : black;
        }

        /* Shop의 팝업 메뉴 스타일 */
        .popup-style-shop{
            position : absolute;
            top : 250%;
            left : 50%;
            transform : translate(-10%);
            background-color : white;
            border : 1px solid #b8b8b8;
            padding : 45px;
            visibility : hidden; 
            opacity : 0; 
            transition : visibility 0.3s, opacity 0.3s ease;
            display: grid;
            grid-template-columns : 1fr 1fr 1fr; 
            gap : 10px;
            z-index: 1000;
        }
        .popup-style-shop ul{
            list-style : none;
            padding : 0;
            margin : 0;
            font-size: 13px;
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }
        .popup-style-shop li a{
            display : block;
            padding : 12px 110px;
            color : black;
        }
        .popup-style-shop li a:hover{
            background-color : white;
        }
        .header-item:hover .popup-style-shop {
            visibility : visible;
            opacity : 1;
        }

        /* Search의 메뉴 스타일 */
        .popup-style-search{
            position : absolute;
            top : 250%;
            left : 50%;
            transform : translate(-50%);
            background-color : white;
            border : 1px solid #b8b8b8;
            padding : 45px;
            visibility : hidden;
            opacity : 0;
            transition : visibility 0.3s, opacity 0.3s ease;
            z-index: 1000;
        }
        .popup-style-search ul{
            list-style : none;
            padding : 0;
            margin : 0;
            font-size: 13px;
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }
        .popup-style-search li a{
            display : block;
            padding : 14px 60px;
            color : black;
        }
        .popup-style-search li a:hover{
            background-color : white;
        }
        .header-item:hover .popup-style-search {
            visibility : visible;
            opacity : 1;
        }

        .spacing-box{
            padding-bottom:600px;
        }

        /* 회원가입 폼 스타일 */
        .membershipClass{
            font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            text-align : center;
        }
        .membershipForm{
            max-width: 450px;
            margin: 0 auto;
            text-align: left;
            padding: 15px;
        }
        
        .formst{
            margin-bottom : 25px;
        }
        .formst label{
            display : block;
            margin-bottom : 7px;
            font-size : 13px;
            color : rgb(79, 79, 79);
        }

        .formst input[type="email"],
        .formst input[type="text"]:not(.phoneNum), 
        .formst input[type="password"]{
            width : 100%;
            border: 1px solid rgb(186, 186, 186);
            font-size : 12px;
            height : 25px;
            padding: 0 5px;
            box-sizing: border-box;
        }
        
        .hyphen {
            margin: 0 5px;
            color: #666;
            line-height: 45px;
            font-size: 16px;
        }

        .phoneGroup {
            display: flex;
            gap: 8px;
        }

        #phone1 {
            flex: 2;
        }

        #phone2 {
            flex: 3;
        }

        #phone3 {
            flex: 3;
        }

        #phone1, #phone2, #phone3 {
            border: 1px solid rgb(186, 186, 186);
            font-size: 12px;
            height: 27px;
            padding: 0 5px;
            box-sizing: border-box;
        }

        .phone-group select,
        .phone-group input {
            border: 1px solid rgb(186, 186, 186);
            font-size: 12px;
            height: 25px;
            padding: 0 5px;
            box-sizing: border-box;
        }

        .agreement-section {
            border-top: 1px solid #ddd;
            margin-top: 20px;
            padding-top: 20px;
        }
        
        .agreement-header,
        .agreement-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .agreement-check {
            justify-content: flex-end;
            margin-top: 10px;
            font-size: 13px;
        }

        .agreement-content {
            margin-bottom: 20px;
            font-size: 13px;
            text-align: left;
        }

        .agreement-content b {
            display: block;
            margin-bottom: 10px;
        }

        .agreement-content textarea {
            width: 98%;
            height: 100px;
            padding: 1%;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            font-size: 12px;
            color: #666;
            resize: none;
        }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
            crossorigin="anonymous"></script>
    
    <header class="main-header">
        <div class="header-menu">
            <ul class="header-links">
                <li class="header-item">
                    <a href="/shop">Shop</a>
                    <div class="popup-style-shop">
                        <ul>
                            <li><a href="/outer"><b>•OUTER</b></a></li>
                            <li><a href="/allouter">All</a></li>
                            <li><a href="/coat">Coat</a></li>
                            <li><a href="/cardigan">Cardigan</a></li>
                        </ul>
                        <ul>
                            <li><a href="/top"><b>•TOP</b></a></li>
                            <li><a href="/alltop">All</a></li>
                            <li><a href="/knit">Knit</a></li>
                            <li><a href="/shirt">Shirt</a></li>
                        </ul>
                        <ul>
                            <li><a href="/bottom"><b>•BOTTOM</b></a></li>
                            <li><a href="/pant">Pant</a></li><br>
                            <li><a href="/shoes">Shoes</a></li>
                        </ul>
                    </div>
                </li>
                <li class="header-item">
                    <a href="/search">Search</a>
                    <div class="popup-style-search">
                        <ul>
                            <li><a href="/new">New</a></li>
                            <li><a href="/best">Best</a></li>
                            <li><a href="/sale">Sale</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
            <span class="logo"><a href="/">y u m i n</a></span>
            <ul class="header-links">
                <li><a href="/login">Login</a></li>
                <li><a href="/order">Order</a></li>
                <li><a href="/cart">Cart</a></li>
            </ul>
        </div>
    </header>
    <br><br><br><br>

    <div class="membershipClass">
        <form class="membershipForm" action="/join" method="POST" th:object="${user}"> <!-- th:object="${user}"는 html 폼과
                                                                                 서버의 java 객체를 연결시켜주는 역할. -->

            <div class="formst">
            <label for="ID">아이디</label>
            <div class="d-flex gap-2">
                <input type="text" id="ID" name="username" class="form-control" placeholder="(영문 대소문자/숫자 5자)" required>
                <button type="button" id="idCheckBtn" class="btn" style="background-color: #474747; border-color: #474747;
                color: white; width: 120px; height:25px; font-size:12px;">중복 확인</button>
            </div>
            <small id="id-message" class="form-text"></small>
        </div>

            <div class="formst">
                <label for="PWD">비밀번호</label>
                <input type="password" id="PWD" name="password" placeholder="(영문 대소문자/숫자 4자~16자)" required>
            </div>

            <div class="formst">
                <label for="PWD_check">비밀번호 확인</label>
                <input type="password" id="PWD_check" name="PWD_check" required>
            </div>
            
            <div class="formst">
                <label for="name">이름</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="formst">
                <label for="phone">휴대전화</label>
                <div class="phoneGroup">
                    <select id="phone1" name="phone1_temp">
                        <option value="010" selected>010</option>
                        <option value="011">011</option>
                        <option value="016">016</option>
                        <option value="017">017</option>
                        <option value="018">018</option>
                        <option value="019">019</option>
                    </select>
                    <span class="hyphen">-</span>
                    <input type="text" id="phone2" name="phone2_temp" maxlength="4"> 
                    <span class="hyphen">-</span>
                    <input type="text" id="phone3" name="phone3_temp" maxlength="4">
                    <input type="hidden" id="phoneNumber" name="phoneNumber">
                </div>
            </div>

            <div class="formst">
                <label for="email">이메일</label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <br><br>
            <div class="formst agreement-section">
                </div>
            <div class="agreement-header">
                <input type="checkbox" id="agree-all">
                <label for="agree-all"><b>이용약관 및 개인정보수집 및 이용, 쇼핑정보 수신에 동의합니다.</b></label>
            </div>
            
            <div class="agreement-content">
                <b>[필수] 이용약관 동의</b>
                <textarea readonly>
                    ** 해당 서식은 공정거래위원회에서 제공하는 전자상거래 표준 약관으로, 쇼핑몰 운영형태에 따른 수정이 필요할 수 있습니다. 쇼핑몰에 적용하시기 전 쇼핑몰 운영 사항 등을 확인하시고 관련 법령 등을 감안하여 적절한 내용을 반영하여 이용하시기 바랍니다. **
                    제1조(목적)
                    이용약관에 동의하십니까?
                </textarea>
                <div class="agreement-check">
                    <input type="checkbox" id="agree-terms" name="agree_terms" required> 
                    <label for="agree-terms">동의함</label>
                </div>
            </div>
            
            <div class="agreement-content">
                <b>[필수] 개인정보 수집 및 이용 동의</b>
                <textarea readonly>
                    1. 개인정보 수집목적 및 이용목적
                    가. 서비스 제공에 따른 요금정산
                    콘텐츠 제공, 구매 및 요금 결제, 물품배송 또는 청구지 등 발송, 금융거래 본인 인증 및 금융 서비스
                    나. 회원 관리
                    회원제 서비스 이용에 따른 본인확인, 개인 식별, 불량회원의 부정 이용 방지와 비인가 사용 방지, 가입 의사 확인
                </textarea>

                <div class="agreement-check">
                    <input type="checkbox" id="agree-privacy" name="agree_privacy" required> 
                    <label for="agree-privacy">동의함</label>
                </div>
            </div>

            <div class="agreement-content">
                <b>[선택] 쇼핑정보 수신 동의</b>
                <textarea readonly>
                    할인쿠폰 및 혜택, 이벤트, 신상품 소식 등 쇼핑몰에서 제공하는 유익한 쇼핑정보를 SMS나 이메일로 받아보실 수 있습니다.
                    단, 주문/거래 정보 및 주요 정책과 관련된 내용은 수신동의 여부와 관계없이 발송됩니다.
                    선택 약관에 동의하지 않으셔도 회원가입은 가능하며, 회원가입 후 회원정보수정 페이지에서 언제든지 수신여부를 변경하실 수 있습니다.
                </textarea>
                <div class="agreement-check">
                    <input type="checkbox" id="agree-sms" name="agree_sms">
                    <label for="agree-sms">동의함</label>
                </div>
            </div><br>

            <div class="formst d-flex justify-content-center">
                <input type="submit"
                       value="Join"
                       class="btn btn-dark w-60"> <!-- 너비 60%-->
            </div>
            
        </form> </div>
    
    <div class="spacing-box"></div>
    사업자 정보 &nbsp; | &nbsp; 010-4205-3932 &nbsp; | &nbsp; ymin0207@naver.com
    <br><br><br>



    
    <script>
        const agreeAll = document.getElementById('agree-all');
        // '전체 동의' 체크박스 제외한 모든 개별 체크박스
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:not(#agree-all)');
        
        // 1. '전체 동의' 클릭 시 모든 개별 약관 동의/해제
        agreeAll.addEventListener('click', function() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = agreeAll.checked;
            });
        });

        // 2. 개별 약관 동의/해제 시 '전체 동의' 상태 업데이트
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // 모든 개별 체크박스가 체크되어 있는지 확인
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                // 모두 체크되어 있으면 '전체 동의'도 체크, 아니면 해제
                agreeAll.checked = allChecked;
            });
        });


        // 회원가입 시 아이디와 비밀번호의 길이가 조건에 맞게 입력 되었는지 확인하는 기능.
        // 검사할 대상들을 변수로 지정
        const form = document.querySelector('.membershipForm');
        const idInput = document.getElementById('ID');
        const pwdInput = document.getElementById('PWD');
        const pwdCheckInput = document.getElementById('PWD_check');
        const idMessage = document.getElementById('id-message');  // 아이디 중복 확인용 변수
        const idCheckBtn = document.getElementById('idCheckBtn');
        let Idchecked = false; // 아이디 중복 확인 통과 여부를 저장하는 변수. / let으로 선언한 변수는 나중에 값을 바꿀 수 있는 변수고,
                                                                        // const로 선언한 변수는 나중에 값을 바꿀 수 없는 변수다.

        // '중복 확인' 버튼 클릭 시
        idCheckBtn.addEventListener('click', async function() {
            const userId = idInput.value;

            // 아이디 길이 검사
            if (userId.length < 5) {
                idMessage.textContent = '아이디는 5자 이상 입력해주세요.';
                idMessage.style.color = 'red';
                isIdChecked = false;
                return;
            }

            try {
                // fetch를 사용해 서버로 아이디 전송 (fetch : 백엔드와 데이터를 주고 받을 수 있게 함. (/join/check-id로 post 방식의 요청을 보냄.))
                const response = await fetch('/join/check-id', {  // await : 서버가 응답할때까지 기다림.
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',   // 사용자가 서버에게 보내는 데이터가 웹 폼 형식으로 인코딩 된 데이터라는 뜻이다.
                    },
                    body: 'ID=' + encodeURIComponent(userId)  // id라는 이름으로 사용자가 입력한 userId 값을 서버에 보냄.
                                                                // encodeURIComponent(userId) : 이 함수는 사용자의 id에 특수문자나 공백이 추가되었을 경우
                                                                // 전송을 위해 url 인코딩을 한다.
                });

                // 서버로부터 JSON 응답을 받음  (json : 데이터를 주고 받을 떄 사용하는 텍스트 형식, key, value 형태의 데이터.)
                const result = await response.json();

                // 응답에 따라 메시지 표시
                if (result.available) {
                    idMessage.textContent = '사용 가능한 아이디입니다.';
                    idMessage.style.color = 'green';
                    isIdChecked = true; // 중복 확인 통과
                } else {
                    idMessage.textContent = '이미 사용 중이거나 사용할 수 없는 아이디입니다.';
                    idMessage.style.color = 'red';
                    isIdChecked = false;
                }

            } catch (error) {   // try 블럭 안에 예상치 못한 오류에 대한 대처 catch 함수.
                console.error('Error:', error);
                idMessage.textContent = '오류가 발생했습니다. 다시 시도해주세요.';
                idMessage.style.color = 'red';
                isIdChecked = false;
            }
        });

        // 아이디 입력창의 내용이 변경되면, '중복 확인'을 다시 하도록 상태 변경
        idInput.addEventListener('input', function() {
            isIdChecked = false; 
            idMessage.textContent = '아이디 입력 후 중복 확인을 해주세요.';
            idMessage.style.color = 'grey';
        });



        // 폼에서 join 버튼을 클릭할 떄마다 내부의 함수를 실행하도록 함.
        form.addEventListener('submit', function(event) {
            
            // 나뉘어서 입력 받은 휴대전화 번호 합치기
            const phone1 = document.getElementById('phone1').value;
            const phone2 = document.getElementById('phone2').value;
            const phone3 = document.getElementById('phone3').value;
            const fullPhoneNumber = phone1 + phone2 + phone3;
            document.getElementById('phoneNumber').value = fullPhoneNumber;
            
            // 아이디 길이 검사 - 아이디의 길이가 5자 이상이 조건이니까, idInput이 5자 미만일 때, 아래의 경고창을 띄운다.
            if (idInput.value.length < 5) {    // 아이디의 길이가 5 미만이면.
                alert('아이디는 5자 이상 입력해주세요.');   // alert() : 사용자에게 경고창을 띄움
                event.preventDefault(); // event.preventDefault() : 폼을 서버로 제출하는 것을 중단시키는 함수다.
                idInput.focus(); // 마우스 커서를 문제가 된 입력창으로 자동 이동 시킨다.
                return; // 검사 중단
            }

            // 비밀번호 길이 검사 - 4자 이상, 16자 이하의 비밀번호 설정이 조건이어서, 4자 미만, 16자 초과일 때 아래의 경고창을 띄운다.
            if (pwdInput.value.length < 4 || pwdInput.value.length > 16) {   // pwdinput의 길이가 4 미만, 16자 초과일 시.
                alert('비밀번호는 4자 이상 16자 이하로 입력해주세요.');   // 경고창
                event.preventDefault(); // 폼 제출을 막음
                pwdInput.focus(); // 비밀번호 입력창에 포커스
                return; // 검사 중단
            }


            // 회원가입할 때 비밀번호 재검사에 입력한 비밀번호가 서로 일치하는지 확인하는 기능.
            if (pwdInput.value !== pwdCheckInput.value) {   // 비밀번호와 비밀번호검사(pwdCheckInput)이 서로 일치하지 않다면,
                alert('비밀번호가 일치하지 않습니다. 다시 입력해주세요.');    // 경고창
                event.preventDefault(); // 폼 제출을 막음
                pwdCheckInput.value = ''; // 비밀번호 확인 필드를 비움
                pwdCheckInput.focus(); // 비밀번호 확인창에 포커스
                return; // 검사 중단
            }

            if (isIdChecked === false) {
                alert('아이디 중복 확인을 완료해주세요.');
                event.preventDefault();
                idInput.focus();
                return;
            }
            
            // 모든 검사를 통과하면 폼이 정상적으로 제출됨
            (action="/join")
        });


    </script>
</body>
</html>